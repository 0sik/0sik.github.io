---
layout: single
title: "ì—”í‹°í‹° í´ë˜ìŠ¤ ê°œë°œ"
toc: true
toc_sticky: true
toc_label: "ëª©ì°¨"
categories: spring
toc_icon: "bars"
tags: [spring]
---

ğŸ“˜ìŠ¤í”„ë§ë¶€íŠ¸

# ëª¨ë“  ë„ë©”ì¸ì„ ë¬¶ê¸° ìœ„í•´ í˜í‚¤ì§€ ì„¤ì •
main-java-jpabook.jpashop-domainì´ë¼ëŠ” í˜í‚¤ì§€ìƒì„±

# ì»¬ëŸ¼ëª… ì„¤ì •, Embedded
```
Member ì—”í‹°í‹° ìƒì„±
@Entity
@Getter @Setter
public class Member {
    @Id @GeneratedValue
    @Column(name ="member_id") //ì»¬ëŸ¼ëª…ì„¤ì •
    private Long id; // member_idë¡œ ì„¤ì •ë¨

    private String name;
    @Embedded ////Addressí´ë˜ìŠ¤ë¥¼ ê°’íƒ€ì… ê°ì²´ë¥¼ ì—”í‹°í‹°ë¡œ ìŠ¹ê²©í•˜ì—¬ë„ ë˜ì§€ë§Œ,
    ê°’íƒ€ì…ì˜ ì—”í‹°í‹° ìŠ¹ê²©ì€ ì‹ë³„ì(id)ì™€ ì§€ì†ì ì¸ ì¶”ì ì´ í•„ìš”í•œ ê²½ìš°ì— ì§„í–‰í•´ì•¼í•œë‹¤.
    ì˜ˆì œì—ì„œì˜ ì£¼ì†ŒëŠ” ì˜ ë³€í•˜ì§€ ì•ŠëŠ” ë°ì´í„°ë¡œ ê°„ì£¼í•˜ì—¬ ê°’íƒ€ì…ìœ¼ë¡œ ì„¤ê³„í•˜ì˜€ë‹¤.
    private Address address;
    

    private List<Order> orders = new ArrayList<>();
}
```
> ì´ í…Œì´ë¸” ì•ˆì—ëŠ” Member_id, name , adress(city,street,zipcode)ê°€ ìƒì„±ëœë‹¤.

## Embeddable
```
Memberì•ˆì—ìˆëŠ” addressí´ë˜ìŠ¤ ìƒì„±
@Embeddable //Addressí´ë˜ìŠ¤ë¥¼ ê°’íƒ€ì… ê°ì²´ë¥¼ ì—”í‹°í‹°ë¡œ ìŠ¹ê²©í•˜ì—¬ë„ ë˜ì§€ë§Œ,ê°’íƒ€ì…ì˜ ì—”í‹°í‹° ìŠ¹ê²©ì€ ì‹ë³„ì(id)ì™€ ì§€ì†ì ì¸ ì¶”ì ì´ í•„ìš”í•œ ê²½ìš°ì— ì§„í–‰í•´ì•¼í•œë‹¤.ì˜ˆì œì—ì„œì˜ ì£¼ì†ŒëŠ” ì˜ ë³€í•˜ì§€ ì•ŠëŠ” ë°ì´í„°ë¡œ ê°„ì£¼í•˜ì—¬ ê°’íƒ€ì…ìœ¼ë¡œ ì„¤ê³„í•˜ì˜€ë‹¤.
@Getter //ì°¸ê³ : ê°’ íƒ€ì…ì€ ë³€ê²½ ë¶ˆê°€ëŠ¥í•˜ê²Œ ì„¤ê³„í•´ì•¼ í•œë‹¤.
// @Setter ë¥¼ ì œê±°í•˜ê³ , ìƒì„±ìì—ì„œ ê°’ì„ ëª¨ë‘ ì´ˆê¸°í™”í•´ì„œ ë³€ê²½ ë¶ˆê°€ëŠ¥í•œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì
public class Address {

    private String city;
    private String street;
    private String zipcode;

    protected Address() {
    }
    public Address(String city, String street, String zipcode) {
        this.city = city;
        this.street = street;
        this.zipcode = zipcode;
    }
}
```
# í…Œì´ë¸”ëª… ë°”ê¾¸ê¸°, ì—”í‹°í‹° ê´€ê³„(m:1),FKê°’ ì„¤ì •,Enumerated, fetch ,cascade ,ì—°ê´€ê´€ê³„ ë©”ì„œë“œ
```
orderì—”í‹°í‹°ìƒì„±
@Entity
@Table(name="orders") //í…Œì´ë¸” ëª…ì„ ordersë¡œ ë°”ê¾¼ë‹¤
@Getter @Setter
public class Order {
    @Id @GeneratedValue
    @Column(name = "order_id")
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY) //ë‹¤ëŒ€ì¼ ê´€ê³„
    @JoinColumn(name = "member_id")
    //ì—¬ê¸°ì˜ ê°’ì´ ë°”ë€Œë©´ FKì˜ ê°’ì´ ë³€ê²½ë¨
    private Member member; // member_idë¡œ ë³€ê²½ memberì˜ FKê°’ì´ ë¨

    @OneToMany(mappedBy = "order",cascade = CascadeType.ALL))
    private List<OrderItem> orderItems = new ArrayList<>();
    @OneToOne
    @JoinColumn(name="delivery_id")//Fkì„¤ì •
    private Delivery delivery;

    private LocalDateTime orderDate;
    @Enumerated(EnumType.STRING)//enumíƒ€ì…ì„ Stringìœ¼ë¡œ ì„¤ì •(ordinalì€ ì“°ì§€ë§ê²ƒ,ìˆ«ìë¡œ ì •ì˜í•˜ëŠ” ê±°ë¼ ì¤‘ê°„ì— ì¶”ê°€ë˜ë©´ ì—ëŸ¬ë°œìƒ
    private OrderStatus status; //ì£¼ë¬¸ìƒíƒœ [ORDER,CANCEL],classê°€ ì•„ë‹Œ enumìœ¼ë¡œ ì •ì˜
    //enum ì´ë€ ê´€ë ¨ì´ ìˆëŠ” ìƒìˆ˜ë“¤ì˜ ì§‘í•©,Stringê³¼ ê°™ì€ ë¬¸ìì—´ì´ë‚˜ ìˆ«ìë“¤ì„ ë‚˜íƒ€ë‚´ëŠ” ê¸°ë³¸ ìë£Œí˜•ì˜ ê°’ì„ ê³ ì •í• ìˆ˜ ìˆë‹¤.
    
    //==ì—°ê´€ê´€ê³„ ë©”ì„œë“œ==//
    public void setMember(Member member){
        this.member = member;
    }
    public void addOrderItem(OrderItem orderItem){
        orderItems.add(orderItem);
        orderItem.setOrder(this);
    }
    public void setDelivery(Delivery delivery){
        this.delivery = delivery;
        delivery.setOrder(this);
    }
}
```
>fetch = FetchType.LAZYë€,
ì¦‰ì‹œë¡œë”©( EAGER )ì€ ì˜ˆì¸¡ì´ ì–´ë µê³ , ì–´ë–¤ SQLì´ ì‹¤í–‰ë ì§€ ì¶”ì í•˜ê¸° ì–´ë µë‹¤. íŠ¹íˆ JPQLì„ ì‹¤í–‰í•  ë•Œ N+1 
ë¬¸ì œê°€ ìì£¼ ë°œìƒí•œë‹¤.
ì‹¤ë¬´ì—ì„œ ëª¨ë“  ì—°ê´€ê´€ê³„ëŠ” ì§€ì—°ë¡œë”©( LAZY )ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•œë‹¤.
ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•¨ê»˜ DBì—ì„œ ì¡°íšŒí•´ì•¼ í•˜ë©´, fetch join ë˜ëŠ” ì—”í‹°í‹° ê·¸ë˜í”„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•œë‹¤
@XToOne(OneToOne, ManyToOne) ê´€ê³„ëŠ” ê¸°ë³¸ì´ ì¦‰ì‹œë¡œë”©ì´ë¯€ë¡œ ì§ì ‘ ì§€ì—°ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•´ì•¼ í•œ
ë‹¤

> cascadeë€ ,
Orderë¥¼ ì €ì¥í• ë•Œ  orderItemê³¼ deliveryê°€ ìë™ìœ¼ë¡œ ì €ì¥ëœë‹¤
Orderì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´  orderItem,deliveryê°€ ì €ì¥ë˜ê³  Orderì— ë˜ ì €ì¥ëœë‹¤.
ex)ì‚¬ìš©í•˜ì§€ ì•Šì•˜ì„ê²½ìš°
persist(oderItemA)
persist(oderItemB)
persist(oderItemC)
persist(order)
ì‚¬ìš©í–ˆì„ê²½ìš°
persist(order)

> ì—°ê´€ê´€ê³„ ë©”ì„œë“œë€ 
ì–‘ë°©í•­ ì—°ê´€ê´€ê³„ì¼ë•Œ ì—°ê´€ê´€ê³„ ë©”ì„œë“œê°€ ìˆìœ¼ë©´ ì¢‹ë‹¤. ì–‘ë°©í–¥ìœ¼ë¡œ ì„¸íŒ…í•´ì¤Œ 


## enum ìƒì„±
```
rderStatusë¼ëŠ” enum ìƒì„±
public enum OrderStatus {
    ORDER,CANCEL
}
```
# Inheritance, DiscriminatorColumn, ì¶”ìƒí´ë˜ìŠ¤ ë§Œë“¤ì–´ì„œ ìì‹ë“¤í•œí…Œ ìƒì†ì‹œí‚¤ê¸°
```
item ì—”í‹°í‹° ìƒì„±
@Entity
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)//tableí•˜ë‚˜ì— ë‹¤ ë„£ëŠ” ë°©ë²•
@DiscriminatorColumn(name="dtype") //Album(A),Movie(M),Book(B)ì¤‘ ë¬´ì—‡ì„ ì„ íƒí–ˆëŠ”ì§€ ë‚˜ì˜¤ëŠ” ë°©ë²•
@Getter @Setter
public abstract class Item {//ì¶”ìƒí´ë˜ìŠ¤ë¡œ ë§Œë“¤ê¸° (abstract)
    @Id @GeneratedValue
    @Column(name = "item_id")
    private Long id;

    private String name;
    private int price;
    private int stockQuantity;

    @ManyToMany(mappedBy = "items")
    private List<Category> categoryies = new ArrayList<>();
}
```
## ìƒì†ë°›ê¸°, DiscriminatorValue
```
item í…Œì´ë¸”ì— ë„£ì„ í´ë˜ìŠ¤ë“¤ ì •ì˜
Albumí´ë˜ìŠ¤
@Entity
@DiscriminatorValue("A")
@Getter @Setter
public class Album extends Item {
    private String artist;
    private String etc;
}
Bookí´ë˜ìŠ¤
@Entity
@DiscriminatorValue("B")
@Getter
@Setter
public class Book extends Item {
    private String author;
    private String isbn;
}
Movieí´ë˜ìŠ¤
@Entity
@DiscriminatorValue("M")
@Getter
@Setter
public class Movie extends Item {
    private String director;
    private String actor;
}
```

# ì•„í‚¤í…ì²˜
ê³„ì¸µí˜• êµ¬ì¡° ì‚¬ìš©
controller,web : ì›¹ ê³„ì¸µ
service : ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§,íŠ¸ëœì­ì…˜ ì²˜ë¦¬
repository : JPAë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê³„ì¸µ, ì—”í‹°í‹° ë§¤ë‹ˆì € ì‚¬ìš©
domain : ì—”í‹°í‹°ê°€ ëª¨ì—¬ ìˆëŠ” ê³„ì¸µ, ëª¨ë“  ê³„ì¸µì—ì„œ ì‚¬ìš© 
íŒ¨í‚¤ì§€ êµ¬ì¡°
jpabook.jpashop
	*domain
    *exception
    *repository
    *service
    *web

